# Taiwan-Criminal-Law-Interactive-Chatbot
This project is made by undergraduate students from the WIDM Lab. (Web Intelligence and Data Mining Laboratory), and is the result of NCU (National Central University) CSIE dept. (Computer Science and Information Engineering department) 2023 project competition.

It has won the Outstanding Performance Award (4th place) in the department-level project competition and the Excellent Award (2nd place) in the college-level project competition.

## Before using
### Download data, pre-trained model and checkpoints
Due to the size of data, model and checkpoints files are too large, you need to download those files and put them into the correct paths manually, and the program can execute correctly.
- [data](https://drive.google.com/drive/folders/1XnbdK3c1cuUHfc3YEQh6q6abtk8Jq1Ab?usp=sharing): put all files into `./legal_judgment_prediction/data`
- [pytorch_model.bin](https://drive.google.com/file/d/1_Zd5-TLNk2Brbk62d0X2Z2mor5KW-lhY/view?usp=sharing): put file into `./legal_judgment_prediction/bert/`
- [checkpoints](https://drive.google.com/drive/folders/1Y18gkLOfDRfqCbNKsmLSCD3lrYmKNoc8?usp=sharing): download the checkpoint you want and put the file into `./legal_judgment_prediction/results/Bert`

### Install the required modules
Run `pip install -r requirements.txt` to install all required modules.

## How to run LJP (Legal Judgment Prediction) model?
This program has three mode: train, eval, serve.

All execution messages are saved in `legal_judgment_prediction/log/Bert.log`.

### Usage
```
python main.py --config [config_file_path] --gpu [gpu IDs] --mode [mode] \
[--checkpoint] [checkpoint_file_path] [--do_test] [--open_server]
```

### Detail of parameters
- --config, -c [config_file_path]: The path of config file. You can use default config `./config.ini`
- --gpu, -g [gpu_IDs]: The list of gpu ID. The first gpu ID starts from 0.
- --mode, -m [mode]: There are three mode: train, eval or serve.
- --checkpoint: The path of checkpoint. (eval, serve mode required)
- --do_test: If you want to do test when training, add this parameter into instruction.
- --open_server: If you want to run this service on Line-Bot, Add this parameter into instruction.

### Train
#### Basic usage
```
python main.py --config [config_file_path] --gpu [gpu_IDs] --mode train \
[--checkpoint] [checkpoint_file_path] [--do_test]
```

In this mode, program will train new checkpoints.

If you add `--checkpoint [checkpoint_file_path]` into instruction, program will train new checkpoints based [checkpoint_file_path].

If you want to do test when training, add `--do_test` into instruction.

### Eval
#### Basic usage
```
python main.py --config [config_file_path] --gpu [gpu_IDs] --mode eval \
--checkpoint [checkpoint_file_path]
```

In this mode, program will evalute test data.

### Serve
#### Basic usage
```
python main.py --config [config_file_path] --gpu [gpu_IDs] --mode serve \
--checkpoint [checkpoint_file_path] [--open_server]
```

In this mode, program can predict the accuse, article and article_source of inputting string.

If you add `--open_server` into instruction, program will open Flask web server. You can use this mode with Line-Bot.

## How to run Line-Bot  
1. Move to root directory `Taiwan-Criminal-Law-Interactive-Chatbot`
2. Revise below settings in ./config.ini
    - [server]
      - server_socket_IP: This can be found with command `ifconfig`.
      - LINE_CHANNEL_ACCESS_TOKEN: This can be found in your channel on LINE Developers.
      - CHANNEL_SECRET: This can be found in your channel on LINE Developers.
3. Run ngrok with instruction `ngrok http 5000`
4. Edit `Webhook URL` in your channel on LINE Developers with the link generated by ngrok
5. Run `main.py` with `serve` mode and add `--open_server` parameter into instruction

## Demo
### Serve (simple_IO)
#### Event Prediction
![Demo_simple_IO](https://drive.google.com/uc?export=view&id=1es_Zejjt5cmiIjL3Pi1N7lisyTTAT5vv)
> Enter `shutdown` in chatroom to close whole system safely.

### Serve (open_server)
#### How to Use
![Demo_Line_Bot_How_to_Use](https://drive.google.com/uc?export=view&id=1fzwK6Qiw410nyMu1Urnwl-2rZDwan6Uq)

#### Today News
![Demo_Line_Bot_Today_News](https://drive.google.com/uc?export=view&id=1g-XObt9kId2HrGfnVHCUeR5m8nOIxxsp)

#### Event Prediction
![Demo_Line_Bot_Event_Prediction](https://drive.google.com/uc?export=view&id=1g-OE3rRpFWDXXa6R0JykIohaVnk4ghKu)

#### Law Search
![Demo_Line_Bot_Law_Search](https://drive.google.com/uc?export=view&id=1g-BnGFPD4zEsJgqvGS6fU6lHQ7-CzEmP)

> Enter `shutdown` in chatroom to close whole system safely (Same as Serve (simple_IO)).
